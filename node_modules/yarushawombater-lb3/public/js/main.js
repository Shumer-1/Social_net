$(document).ready(function() {
    // Открытие диалогового окна для добавления пользователя
    $('#addUserBtn').on('click', function() {
        $('#userDialog').dialog({
            modal: true,
            width: 500,
            title: "Добавить пользователя"
        });
    });

    // Закрытие диалогового окна
    window.closeDialog = function() {
        $('#userDialog').dialog('close');
    };

    // Обработка формы добавления пользователя
    $('#userForm').on('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);

        $.ajax({
            url: '/admin/users',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                location.reload();
            },
            error: function(xhr, status, error) {
                let errorMessage = 'Произошла неизвестная ошибка.';
                let errorStatus = xhr.status;

                if (xhr.responseJSON && xhr.responseJSON.message) {
                    errorMessage = xhr.responseJSON.message;
                } else if (xhr.responseText) {
                    // Попытка извлечь сообщение из HTML-ответа
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(xhr.responseText, 'text/html');
                    const errorText = doc.querySelector('.error-container p');
                    if (errorText) {
                        errorMessage = errorText.textContent;
                    }
                }

                alert(`Ошибка ${errorStatus}: ${errorMessage}`);
            }
        });
    });
});
